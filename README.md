# DDL-MSP
This is code for article "A Dual-Stage Deep Learning Multi-Source Precipitation Merging Framework with UNet-UNet for Improving Seasonal and Extreme Precipitation Forecasting"

The model code used in all articles is generated by running .ipynb files. The filenames contain different model names, such as "xxx-xxxxx-Unet" indicating the use of the Unet model. Files named in Chinese with the suffix "-分类器" represent the classifier of the hybrid model, while those with "-分类器-回归器" denote the regressor of the hybrid model. All data used can be found in the data section of the article, which exclusively employs publicly available datasets downloadable from various institutional websites.  

When using the code, all models generally follow these steps:  
1. Import libraries  
2. Read data  
3. Preprocess data  
4. Define the model  
5. Train and test the model  
6. Save the model and output results

When running the "-分类器-回归器" code, you should first train and save the model during the initial run, then proceed with loading the model, result prediction, data saving, and metric calculation. Specifically, the code before "model=load_model" handles data preprocessing—run this first, followed by the second-to-last code block (model definition function), and finally the last code block (model training and saving). For subsequent runs when the model is already saved, you only need to execute the sections before the second-to-last code block (i.e., no need to redefine or retrain the model) to obtain the data results. The reason for splitting the runs is to account for complex models that may exceed GPU memory limits.

The .ipynb files that generate the final models in the article all have the suffix "CN05-morev-sm2," indicating that we used CN05.1 data as observational data, employed multiple physical predictors, and incorporated soil moisture as a predictor (for example, "萱萱-多源降水数据融合-lstm-分类器-回归器-CN05-morev-sm2.ipynb" represents the training code for the regressor in the final LSTM hybrid model we adopted). Other .ipynb files that do not follow the above naming convention are experiments we conducted in the early stages to select predictors and debug models, which are not presented in the paper; interested readers can try running them on their own.

In the code, all .ipynb files with names containing "论文出图" (thesis plotting) or "散点图" (scatter plot) are for result visualization (plotting). Files with "POD-FAR" are used for classifier metric calculations, while those labeled "数据预处理" (data preprocessing) perform data preprocessing operations.

Ensure all required libraries are installed before importing them. All model code is presented in function form, with detailed usage instructions (parameter definitions) available in the "Python气象自动绘图函数说明" document (written in Chinese). The "Auto_paint_self" file has already been uploaded.  

For any questions, please email the author at: 492947833@qq.com
